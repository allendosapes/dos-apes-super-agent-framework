{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",

  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo 'ðŸ¦ Dos Apes session started. Branch: '$(git branch --show-current)'. Tasks:' && cat .planning/ROADMAP.md 2>/dev/null | head -5 || echo 'No roadmap yet'",
            "timeout": 10
          },
          {
            "type": "command",
            "command": "bash scripts/metrics-init.sh 2>/dev/null || true",
            "timeout": 10
          }
        ]
      }
    ],

    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash scripts/guard-main-branch.sh",
            "timeout": 5
          }
        ]
      }
    ],

    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash scripts/hook-format-and-stage.sh 2>/dev/null || true",
            "timeout": 10
          },
          {
            "type": "command",
            "command": "bash scripts/hook-typecheck.sh 2>/dev/null || true",
            "timeout": 30
          },
          {
            "type": "command",
            "command": "bash scripts/hook-test-related.sh 2>/dev/null || true",
            "timeout": 60
          },
          {
            "type": "command",
            "command": "bash scripts/track-modified-files.sh 2>/dev/null || true",
            "timeout": 5
          },
          {
            "type": "command",
            "command": "bash scripts/metrics-update.sh 2>/dev/null || true",
            "timeout": 5
          }
        ]
      }
    ],

    "Stop": [
      {
        "hooks": [
          {
            "type": "agent",
            "prompt": "IMPORTANT: Your ENTIRE response must be a single JSON object â€” nothing else.\nNo text before it, no text after it, no markdown code fences, no explanation.\n\nValid responses (pick exactly one):\n  {\"ok\": true}\n  {\"ok\": false, \"reason\": \"description of issues\"}\n\nIf stop_hook_active is true in the hook input, respond: {\"ok\": true}\n\nSteps:\n1. Read .planning/.modified-files.txt â€” if it does not exist or is empty, respond: {\"ok\": true}\n   Do NOT read any other files until step 1 succeeds with content.\n2. Read .claude/skills/review.md for review guidelines.\n3. Review each modified file. Only flag issues with confidence >= 80.\n4. No issues >= 80: {\"ok\": true}\n5. Issues found: {\"ok\": false, \"reason\": \"Fix: [file:line - category (N) - desc] ...\"}\n\nCRITICAL: Output ONLY the JSON object. No prose. No markdown. No fences.",
            "timeout": 180
          }
        ]
      }
    ]
  },

  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["@playwright/mcp@latest", "--headless"]
    }
  },

  "permissions": {
    "allow": [
      "Bash(git status)",
      "Bash(git diff *)",
      "Bash(git log *)",
      "Bash(git branch *)",
      "Bash(git checkout *)",
      "Bash(git add *)",
      "Bash(git commit *)",
      "Bash(git push *)",
      "Bash(git pull *)",
      "Bash(git fetch *)",
      "Bash(git merge *)",
      "Bash(git rebase *)",
      "Bash(git stash *)",
      "Bash(git worktree *)",
      "Bash(git remote *)",
      "Bash(git show *)",
      "Bash(git rev-parse *)",
      "Bash(git config --get *)",
      "Bash(git tag *)",
      "Bash(npm *)",
      "Bash(npx *)",
      "Bash(yarn *)",
      "Bash(pnpm *)",
      "Bash(bun *)",
      "Bash(node *)",
      "Bash(tsc *)",
      "Bash(tsx *)",
      "Bash(vitest *)",
      "Bash(jest *)",
      "Bash(eslint *)",
      "Bash(prettier *)",
      "Bash(cat *)",
      "Bash(ls *)",
      "Bash(find *)",
      "Bash(grep *)",
      "Bash(rg *)",
      "Bash(wc *)",
      "Bash(head *)",
      "Bash(tail *)",
      "Bash(mkdir *)",
      "Bash(cp *)",
      "Bash(mv *)",
      "Bash(rm *)",
      "Bash(touch *)",
      "Bash(echo *)",
      "Bash(sed *)",
      "Bash(awk *)",
      "Bash(chmod +x *)",
      "Bash(which *)",
      "Bash(pwd)",
      "Bash(date *)",
      "Bash(sort *)",
      "Bash(uniq *)",
      "Bash(tr *)",
      "Bash(cut *)",
      "Bash(xargs *)",
      "Bash(bash *)",
      "Bash(gitleaks *)",
      "Read",
      "Edit",
      "Write",
      "Grep",
      "Glob",
      "Task",
      "TodoWrite",
      "WebFetch"
    ]
  },

  "env": {
    "DOS_APES_FRAMEWORK": "true",
    "DOS_APES_VERSION": "2.0.0",
    "DOS_APES_GATE_SCRIPT": "scripts/check-task-gates.sh"
  }
}
