{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",

  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo 'ðŸ¦ Dos Apes session started. Branch: '$(git branch --show-current)'. Tasks:' && cat .planning/ROADMAP.md 2>/dev/null | head -5 || echo 'No roadmap yet'",
            "timeout": 10
          },
          {
            "type": "command",
            "command": "bash scripts/metrics-init.sh 2>/dev/null || true",
            "timeout": 10
          }
        ]
      }
    ],

    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash scripts/guard-main-branch.sh",
            "timeout": 5
          }
        ]
      }
    ],

    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash scripts/hook-format-and-stage.sh",
            "timeout": 10
          },
          {
            "type": "command",
            "command": "bash scripts/hook-typecheck.sh",
            "timeout": 30
          },
          {
            "type": "command",
            "command": "bash scripts/hook-test-related.sh",
            "timeout": 60
          },
          {
            "type": "command",
            "command": "bash scripts/track-modified-files.sh 2>/dev/null || true",
            "timeout": 5
          },
          {
            "type": "command",
            "command": "bash scripts/metrics-update.sh 2>/dev/null || true",
            "timeout": 5
          }
        ]
      }
    ],

    "Stop": [
      {
        "hooks": [
          {
            "type": "agent",
            "prompt": "You are an automated code review gate. Check if files modified in this session have issues.\n\nFirst: if stop_hook_active is true in the hook input, respond immediately with: {\"ok\": true}\n\nSteps:\n1. Read .planning/.modified-files.txt for the list of modified files\n2. If the file does not exist or is empty, respond with: {\"ok\": true}\n3. Read .claude/skills/review.md for review guidelines\n4. Review each modified file. Only flag issues with confidence >= 80\n5. If no issues >= 80 confidence, respond with: {\"ok\": true}\n6. If issues found, respond with: {\"ok\": false, \"reason\": \"Fix before completing: [file:line - category (confidence: N) - description for each issue]\"}\n\nYou MUST respond with ONLY JSON: {\"ok\": true} or {\"ok\": false, \"reason\": \"...\"}",
            "timeout": 180
          }
        ]
      }
    ]
  },

  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["@playwright/mcp@latest", "--headless"]
    }
  },

  "permissions": {
    "allow": [
      "Bash(git status)",
      "Bash(git diff *)",
      "Bash(git log *)",
      "Bash(git branch *)",
      "Bash(git checkout *)",
      "Bash(git add *)",
      "Bash(git commit *)",
      "Bash(git push *)",
      "Bash(git pull *)",
      "Bash(git fetch *)",
      "Bash(git merge *)",
      "Bash(git rebase *)",
      "Bash(git stash *)",
      "Bash(git worktree *)",
      "Bash(git remote *)",
      "Bash(git show *)",
      "Bash(git rev-parse *)",
      "Bash(git config --get *)",
      "Bash(git tag *)",
      "Bash(npm *)",
      "Bash(npx *)",
      "Bash(yarn *)",
      "Bash(pnpm *)",
      "Bash(bun *)",
      "Bash(node *)",
      "Bash(tsc *)",
      "Bash(tsx *)",
      "Bash(vitest *)",
      "Bash(jest *)",
      "Bash(eslint *)",
      "Bash(prettier *)",
      "Bash(cat *)",
      "Bash(ls *)",
      "Bash(find *)",
      "Bash(grep *)",
      "Bash(rg *)",
      "Bash(wc *)",
      "Bash(head *)",
      "Bash(tail *)",
      "Bash(mkdir *)",
      "Bash(cp *)",
      "Bash(mv *)",
      "Bash(rm *)",
      "Bash(touch *)",
      "Bash(echo *)",
      "Bash(sed *)",
      "Bash(awk *)",
      "Bash(chmod +x *)",
      "Bash(which *)",
      "Bash(pwd)",
      "Bash(date *)",
      "Bash(sort *)",
      "Bash(uniq *)",
      "Bash(tr *)",
      "Bash(cut *)",
      "Bash(xargs *)",
      "Bash(bash *)",
      "Bash(gitleaks *)",
      "Read",
      "Edit",
      "Write",
      "Grep",
      "Glob",
      "Task",
      "TodoWrite",
      "WebFetch"
    ]
  },

  "env": {
    "DOS_APES_FRAMEWORK": "true",
    "DOS_APES_VERSION": "2.0.0"
  }
}
